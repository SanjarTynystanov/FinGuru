const translations = {
    ru: {
        'nav-home': 'Главная',
        'nav-features': 'Возможности',
        'feature-currency-menu': 'Конвертер',
        'feature-budget-menu': 'Бюджет',
        'feature-dashboard-menu': 'Панель управления',
        'feature-goals-menu': 'Цели',
        'feature-forecast-menu': 'Прогноз',
        'feature-reminders-menu': 'Напоминания',
        'feature-tips-menu': 'Советы',
        'nav-banks': 'Банки',
        'banks-connected': 'Подключённые',
        'banks-add': 'Добавить',
        'banks-settings': 'Настройки',
        'banks-faq': 'FAQ',
        'nav-analytics': 'Аналитика',
        'nav-faq': 'FAQ',
        'login': 'Войти',
        'logout': 'Выход',
        'register': 'Регистрация',
        'contacts': 'Контакты',
        'phone': 'Телефон: +7 (123) 456-78-90',
        'social-telegram': 'Telegram',
        'social-vk': 'VK',
        'subscribe': 'Подписка',
        'subscribe-text': 'Получайте финансовые советы на почту',
        'email-placeholder': 'Ваш email',
        'subscribe-btn': 'Подписаться',
        'footer-privacy': 'Политика конфиденциальности',
        'footer-terms': 'Условия использования',
        'privacy-policy': 'Политика конфиденциальности',
        'terms-of-use': 'Условия использования',
        'tips-title': '💡 Полезные советы по финансовой грамотности',
        'tips-intro': 'Управление личными финансами — важный навык для достижения финансовой свободы. Здесь вы найдете практические рекомендации и вдохновение для улучшения своих финансов.',
        'tip-budget': '1. Ведите бюджет',
        'tip-budget-desc': 'Записывайте все доходы и расходы для контроля трат и планирования накоплений.',
        'tip-reserve': '2. Создайте резервный фонд',
        'tip-reserve-desc': 'Откладывайте минимум 10% дохода на непредвиденные расходы — это даст уверенность.',
        'tip-invest': '3. Инвестируйте с умом',
        'tip-invest-desc': 'Изучайте финансовые инструменты и инвестируйте в долгосрочной перспективе.',
        'tip-debts': '4. Следите за долгами',
        'tip-debts-desc': 'Погашайте долги вовремя, чтобы избежать штрафов и ухудшения кредитной истории.',
        'tip-impulse': '5. Контролируйте импульсивные покупки',
        'tip-impulse-desc': 'Думайте перед покупкой, избегайте ненужных трат.',
        'tip-education': '6. Образование — ключ к успеху',
        'tip-education-desc': 'Постоянно учитесь финансовой грамотности и анализируйте свои ошибки.',
        'video-section-title': '🎥 Видео: Основы финансовой грамотности'
    },
    en: {
        'nav-home': 'Home',
        'nav-features': 'Features',
        'feature-currency-menu': 'Converter',
        'feature-budget-menu': 'Budget',
        'feature-dashboard-menu': 'Dashboard',
        'feature-goals-menu': 'Goals',
        'feature-forecast-menu': 'Forecast',
        'feature-reminders-menu': 'Reminders',
        'feature-tips-menu': 'Tips',
        'nav-banks': 'Banks',
        'banks-connected': 'Connected',
        'banks-add': 'Add',
        'banks-settings': 'Settings',
        'banks-faq': 'FAQ',
        'nav-analytics': 'Analytics',
        'nav-faq': 'FAQ',
        'login': 'Login',
        'logout': 'Logout',
        'register': 'Register',
        'contacts': 'Contacts',
        'phone': 'Phone: +7 (123) 456-78-90',
        'social-telegram': 'Telegram',
        'social-vk': 'VK',
        'subscribe': 'Subscribe',
        'subscribe-text': 'Get financial tips by email',
        'email-placeholder': 'Your email',
        'subscribe-btn': 'Subscribe',
        'footer-privacy': 'Privacy Policy',
        'footer-terms': 'Terms of Use',
        'privacy-policy': 'Privacy Policy',
        'terms-of-use': 'Terms of Use',
        'tips-title': '💡 Helpful Financial Literacy Tips',
        'tips-intro': 'Managing personal finances is a key skill for achieving financial freedom. Here you’ll find practical advice and inspiration to improve your finances.',
        'tip-budget': '1. Keep a Budget',
        'tip-budget-desc': 'Track all your income and expenses to control spending and plan savings.',
        'tip-reserve': '2. Create an Emergency Fund',
        'tip-reserve-desc': 'Set aside at least 10% of your income for unexpected expenses — it will give you confidence.',
        'tip-invest': '3. Invest Wisely',
        'tip-invest-desc': 'Learn about financial instruments and invest for the long term.',
        'tip-debts': '4. Monitor Your Debts',
        'tip-debts-desc': 'Pay off debts on time to avoid penalties and damage to your credit history.',
        'tip-impulse': '5. Control Impulse Purchases',
        'tip-impulse-desc': 'Think before buying, avoid unnecessary spending.',
        'tip-education': '6. Education is the Key to Success',
        'tip-education-desc': 'Keep learning about financial literacy and analyze your mistakes.',
        'video-section-title': '🎥 Video: Basics of Financial Literacy'
    },
    ky: {
        'nav-home': 'Башкы бет',
        'nav-features': 'Мүмкүнчүлүктөр',
        'feature-currency-menu': 'Конвертер',
        'feature-budget-menu': 'Бюджет',
        'feature-dashboard-menu': 'Башкаруу панели',
        'feature-goals-menu': 'Максаттар',
        'feature-forecast-menu': 'Болжолдоо',
        'feature-reminders-menu': 'Эскертмелер',
        'feature-tips-menu': 'Кеңештер',
        'nav-banks': 'Банктар',
        'banks-connected': 'Туташкан',
        'banks-add': 'Кошуу',
        'banks-settings': 'Жөндөөлөр',
        'banks-faq': 'FAQ',
        'nav-analytics': 'Аналитика',
        'nav-faq': 'Сурактар',
        'login': 'Кирүү',
        'logout': 'Чыгуу',
        'register': 'Катталуу',
        'contacts': 'Байланыш',
        'phone': 'Телефон: +7 (123) 456-78-90',
        'social-telegram': 'Telegram',
        'social-vk': 'VK',
        'subscribe': 'Жазылуу',
        'subscribe-text': 'Каржы кеңештерин почтага алыңыз',
        'email-placeholder': 'Сиздин email',
        'subscribe-btn': 'Жазылуу',
        'footer-privacy': 'Жеке маалымат саясаты',
        'footer-terms': 'Колдонуу шарттары',
        'privacy-policy': 'Жеке маалымат саясаты',
        'terms-of-use': 'Колдонуу шарттары',
        'tips-title': '💡 Каржы сабаттуулугу боюнча пайдалуу кеңештер',
        'tips-intro': 'Жеке финансыларды башкаруу — каржы эркиндигине жетүүнүн маанилүү көндүмү. Бул жерден сиз финансыңызды жакшыртуу үчүн практикалык сунуштарды жана шыктандырууну таба аласыз.',
        'tip-budget': '1. Бюджетти жазыңыз',
        'tip-budget-desc': 'Бардык кирешелериңизди жана чыгашаларыңызды жазып, чыгымдарды көзөмөлдөп, топтоолорду пландаңыз.',
        'tip-reserve': '2. Запас фондун түзүңүз',
        'tip-reserve-desc': 'Күтүлбөгөн чыгымдар үчүн кирешеңиздин жок дегенде 10%ын бөлүп коюңуз — бул сизге ишеним берет.',
        'tip-invest': '3. Акылдуу инвестиция кылыңыз',
        'tip-invest-desc': 'Каржы инструменттерин үйрөнүңүз жана узак мөөнөткө инвестиция салыңыз.',
        'tip-debts': '4. Карыздарыңызды көзөмөлдөңүз',
        'tip-debts-desc': 'Карыздарыңызды убагында төлөп туруңуз, айыппулдардан жана кредиттик тарыхыңыздын начарлашынан качыңыз.',
        'tip-impulse': '5. Импульсивдүү сатып алууларды көзөмөлдөңүз',
        'tip-impulse-desc': 'Сатып алардан мурун ойлонуп, керексиз чыгымдардан качыңыз.',
        'tip-education': '6. Билим — ийгиликтин ачкычы',
        'tip-education-desc': 'Каржы сабаттуулугун тынымсыз үйрөнүңүз жана каталарыңызды талдаңыз.',
        'video-section-title': '🎥 Видео: Каржы сабаттуулугунуn негиздери'
    }
};

let currentLang = localStorage.getItem('language') || 'ru';
let currentTheme = localStorage.getItem('theme') || 'light';

function updateLanguage() {
    document.querySelectorAll('[data-lang-key]').forEach(el => {
        const key = el.dataset.langKey;
        if (key && translations[currentLang][key]) {
            if (el.tagName === 'INPUT' && el.placeholder !== undefined) {
                el.placeholder = translations[currentLang][key];
            } else {
                el.innerHTML = translations[currentLang][key];
            }
        }
    });
    document.documentElement.lang = currentLang;
}

function applyTheme() {
    const body = document.body;
    if (currentTheme === 'dark') {
        body.classList.add('dark-theme');
        body.classList.remove('light-theme');
    } else {
        body.classList.add('light-theme');
        body.classList.remove('dark-theme');
    }
    localStorage.setItem('theme', currentTheme);
}

document.addEventListener('DOMContentLoaded', () => {
    // Инициализация языка
    document.querySelectorAll('.lang-btn').forEach(btn => {
        if (btn.dataset.lang === currentLang) btn.classList.add('active');
        btn.addEventListener('click', () => {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentLang = btn.dataset.lang;
            localStorage.setItem('language', currentLang);
            updateLanguage();
        });
    });

    // Инициализация темы
    const themeBtn = document.getElementById('themeToggle');
    if (themeBtn) {
        applyTheme(); // Применяем тему при загрузке
        themeBtn.addEventListener('click', () => {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme();
        });
    }

    // Инициализация перевода
    updateLanguage();

    // Обработчик для выпадающих меню
    document.querySelectorAll('.dropdown-toggle').forEach(button => {
        button.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            const menu = button.nextElementSibling;
            const isExpanded = button.getAttribute('aria-expanded') === 'true';

            // Закрываем другие открытые меню
            document.querySelectorAll('.dropdown-menu.show').forEach(openMenu => {
                if (openMenu !== menu) {
                    openMenu.classList.remove('show');
                    openMenu.previousElementSibling.setAttribute('aria-expanded', 'false');
                }
            });

            menu.classList.toggle('show', !isExpanded);
            button.setAttribute('aria-expanded', !isExpanded);

            // Корректировка положения меню
            if (menu.classList.contains('show')) {
                const rect = menu.getBoundingClientRect();
                if (rect.right > window.innerWidth - 10) {
                    menu.style.left = 'unset';
                    menu.style.right = '0';
                } else if (rect.left < 10) {
                    menu.style.left = '0';
                    menu.style.right = 'unset';
                } else {
                    menu.style.left = '0';
                    menu.style.right = 'unset';
                }
            }
        });
    });

    // Закрытие меню при клике вне его
    document.addEventListener('click', (e) => {
        const isDropdownClick = e.target.closest('.dropdown');
        if (!isDropdownClick) {
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
                menu.previousElementSibling.setAttribute('aria-expanded', 'false');
            });
        }
    });

    // Функция выхода
    window.logoutUser = function() {
        fetch('/logout', {
            method: 'POST',
        })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                window.location.href = data.redirect;
            })
            .catch(err => console.error('Ошибка при выходе:', err));
    };
});